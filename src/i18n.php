<?php
function detect_locale(): string
{
    $supported = ['zh', 'en', 'fr', 'es', 'pt', 'de', 'it', 'ru', 'ko', 'ja', 'th', 'id', 'vi', 'hi'];
    $header = $_SERVER['HTTP_ACCEPT_LANGUAGE'] ?? '';
    $parts = explode(',', $header);
    foreach ($parts as $part) {
        $code = strtolower(trim(explode(';', $part)[0]));
        $code = substr($code, 0, 2);
        if (in_array($code, $supported, true)) {
            return $code;
        }
    }
    return 'en';
}

function translations(): array
{
    return [
        'en' => [
            'site_title' => 'SyPhotos Aviation Library',
            'nav_home' => 'Home',
            'nav_upload' => 'Upload',
            'nav_login' => 'Login',
            'nav_register' => 'Register',
            'nav_profile' => 'Profile',
            'nav_review' => 'Review',
            'search_placeholder' => 'Search registration, type, airline, airport',
            'latest_photos' => 'Latest Photos',
            'likes' => 'Likes',
            'exif' => 'EXIF Details',
            'submit' => 'Submit',
            'logout' => 'Logout',
        ],
        'zh' => [
            'site_title' => 'SyPhotos 航空图库',
            'nav_home' => '首页',
            'nav_upload' => '上传',
            'nav_login' => '登录',
            'nav_register' => '注册',
            'nav_profile' => '个人主页',
            'nav_review' => '审核',
            'search_placeholder' => '搜索注册号、机型、航司、机场',
            'latest_photos' => '最新照片',
            'likes' => '点赞',
            'exif' => 'EXIF 信息',
            'submit' => '提交',
            'logout' => '退出',
        ],
        'fr' => [
            'site_title' => 'Bibliothèque aéronautique SyPhotos',
            'nav_home' => 'Accueil',
            'nav_upload' => 'Téléverser',
            'nav_login' => 'Connexion',
            'nav_register' => 'Inscription',
            'nav_profile' => 'Profil',
            'nav_review' => 'Modération',
            'search_placeholder' => 'Rechercher immatriculation, type, compagnie, aéroport',
            'latest_photos' => 'Dernières photos',
            'likes' => 'Mentions J’aime',
            'exif' => 'Détails EXIF',
            'submit' => 'Envoyer',
            'logout' => 'Déconnexion',
        ],
        'es' => [
            'site_title' => 'Biblioteca de aviación SyPhotos',
            'nav_home' => 'Inicio',
            'nav_upload' => 'Subir',
            'nav_login' => 'Iniciar sesión',
            'nav_register' => 'Registrarse',
            'nav_profile' => 'Perfil',
            'nav_review' => 'Revisión',
            'search_placeholder' => 'Buscar matrícula, tipo, aerolínea, aeropuerto',
            'latest_photos' => 'Últimas fotos',
            'likes' => 'Me gusta',
            'exif' => 'Detalles EXIF',
            'submit' => 'Enviar',
            'logout' => 'Cerrar sesión',
        ],
        'pt' => [
            'site_title' => 'Biblioteca de aviação SyPhotos',
            'nav_home' => 'Início',
            'nav_upload' => 'Enviar',
            'nav_login' => 'Entrar',
            'nav_register' => 'Registrar',
            'nav_profile' => 'Perfil',
            'nav_review' => 'Revisão',
            'search_placeholder' => 'Buscar registro, tipo, companhia aérea, aeroporto',
            'latest_photos' => 'Fotos recentes',
            'likes' => 'Curtidas',
            'exif' => 'Detalhes EXIF',
            'submit' => 'Enviar',
            'logout' => 'Sair',
        ],
        'de' => [
            'site_title' => 'SyPhotos Luftfahrtbibliothek',
            'nav_home' => 'Startseite',
            'nav_upload' => 'Hochladen',
            'nav_login' => 'Anmelden',
            'nav_register' => 'Registrieren',
            'nav_profile' => 'Profil',
            'nav_review' => 'Prüfung',
            'search_placeholder' => 'Suche nach Registrierung, Typ, Airline, Flughafen',
            'latest_photos' => 'Neueste Fotos',
            'likes' => 'Likes',
            'exif' => 'EXIF-Details',
            'submit' => 'Senden',
            'logout' => 'Abmelden',
        ],
        'it' => [
            'site_title' => 'Biblioteca aeronautica SyPhotos',
            'nav_home' => 'Home',
            'nav_upload' => 'Carica',
            'nav_login' => 'Accedi',
            'nav_register' => 'Registrati',
            'nav_profile' => 'Profilo',
            'nav_review' => 'Revisione',
            'search_placeholder' => 'Cerca matricola, tipo, compagnia, aeroporto',
            'latest_photos' => 'Foto recenti',
            'likes' => 'Mi piace',
            'exif' => 'Dettagli EXIF',
            'submit' => 'Invia',
            'logout' => 'Esci',
        ],
        'ru' => [
            'site_title' => 'Авиационная библиотека SyPhotos',
            'nav_home' => 'Главная',
            'nav_upload' => 'Загрузить',
            'nav_login' => 'Войти',
            'nav_register' => 'Регистрация',
            'nav_profile' => 'Профиль',
            'nav_review' => 'Проверка',
            'search_placeholder' => 'Поиск по регистрации, типу, авиакомпании, аэропорту',
            'latest_photos' => 'Новые фото',
            'likes' => 'Лайки',
            'exif' => 'Данные EXIF',
            'submit' => 'Отправить',
            'logout' => 'Выйти',
        ],
        'ko' => [
            'site_title' => 'SyPhotos 항공 사진관',
            'nav_home' => '홈',
            'nav_upload' => '업로드',
            'nav_login' => '로그인',
            'nav_register' => '회원가입',
            'nav_profile' => '프로필',
            'nav_review' => '검토',
            'search_placeholder' => '등록부호, 기종, 항공사, 공항 검색',
            'latest_photos' => '최신 사진',
            'likes' => '좋아요',
            'exif' => 'EXIF 정보',
            'submit' => '제출',
            'logout' => '로그아웃',
        ],
        'ja' => [
            'site_title' => 'SyPhotos 航空ライブラリ',
            'nav_home' => 'ホーム',
            'nav_upload' => 'アップロード',
            'nav_login' => 'ログイン',
            'nav_register' => '登録',
            'nav_profile' => 'プロフィール',
            'nav_review' => '審査',
            'search_placeholder' => '登録記号、機種、航空会社、空港を検索',
            'latest_photos' => '最新写真',
            'likes' => 'いいね',
            'exif' => 'EXIF 詳細',
            'submit' => '送信',
            'logout' => 'ログアウト',
        ],
        'th' => [
            'site_title' => 'คลังภาพการบิน SyPhotos',
            'nav_home' => 'หน้าแรก',
            'nav_upload' => 'อัปโหลด',
            'nav_login' => 'เข้าสู่ระบบ',
            'nav_register' => 'สมัครสมาชิก',
            'nav_profile' => 'โปรไฟล์',
            'nav_review' => 'ตรวจสอบ',
            'search_placeholder' => 'ค้นหาทะเบียน, รุ่น, สายการบิน, สนามบิน',
            'latest_photos' => 'ภาพล่าสุด',
            'likes' => 'ถูกใจ',
            'exif' => 'รายละเอียด EXIF',
            'submit' => 'ส่ง',
            'logout' => 'ออกจากระบบ',
        ],
        'id' => [
            'site_title' => 'Perpustakaan penerbangan SyPhotos',
            'nav_home' => 'Beranda',
            'nav_upload' => 'Unggah',
            'nav_login' => 'Masuk',
            'nav_register' => 'Daftar',
            'nav_profile' => 'Profil',
            'nav_review' => 'Tinjau',
            'search_placeholder' => 'Cari registrasi, tipe, maskapai, bandara',
            'latest_photos' => 'Foto terbaru',
            'likes' => 'Suka',
            'exif' => 'Detail EXIF',
            'submit' => 'Kirim',
            'logout' => 'Keluar',
        ],
        'vi' => [
            'site_title' => 'Thư viện hàng không SyPhotos',
            'nav_home' => 'Trang chủ',
            'nav_upload' => 'Tải lên',
            'nav_login' => 'Đăng nhập',
            'nav_register' => 'Đăng ký',
            'nav_profile' => 'Hồ sơ',
            'nav_review' => 'Duyệt',
            'search_placeholder' => 'Tìm đăng ký, loại, hãng bay, sân bay',
            'latest_photos' => 'Ảnh mới nhất',
            'likes' => 'Thích',
            'exif' => 'Chi tiết EXIF',
            'submit' => 'Gửi',
            'logout' => 'Đăng xuất',
        ],
        'hi' => [
            'site_title' => 'SyPhotos विमानन लाइब्रेरी',
            'nav_home' => 'मुखपृष्ठ',
            'nav_upload' => 'अपलोड',
            'nav_login' => 'लॉगिन',
            'nav_register' => 'रजिस्टर',
            'nav_profile' => 'प्रोफ़ाइल',
            'nav_review' => 'समीक्षा',
            'search_placeholder' => 'रजिस्ट्रेशन, प्रकार, एयरलाइन, हवाई अड्डा खोजें',
            'latest_photos' => 'नवीनतम फोटो',
            'likes' => 'लाइक्स',
            'exif' => 'EXIF विवरण',
            'submit' => 'जमा करें',
            'logout' => 'लॉगआउट',
        ],
    ];
}

function t(string $key): string
{
    $locale = $_SESSION['locale'] ?? detect_locale();
    $_SESSION['locale'] = $locale;
    $bundle = translations();
    return $bundle[$locale][$key] ?? $bundle['en'][$key] ?? $key;
}
